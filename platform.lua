-- title:  Platformer Demo
-- author: trelemar
-- modified by: jaymzee
-- desc:   Demo made for tutorial @ infinitelimit.net
-- script: lua
-- input:  gamepad

function solid(x,y)
	local s = mget(x//8,y//8) -- get sprite at cell
	return x<0 or fget(s,0) -- return solid flag
end

function edible(x,y)
	local s = mget(x//8,y//8)
	return fget(s,1)
end

function init()
	t=0
	p={
		x=120,
		y=68,
		vx=0, --Velocity X
		vy=0, --Velocity Y
		dir=0
	}
end

function TIC()
	if btn(2) then
		p.vx=-1
		p.dir=1
	elseif btn(3) then
		p.vx=1
		p.dir=0
	else
		p.vx=0
	end

	if solid(p.x+p.vx  ,p.y+p.vy  ) or
	   solid(p.x+p.vx+7,p.y+p.vy  ) or
	   solid(p.x+p.vx  ,p.y+p.vy+7) or
	   solid(p.x+p.vx+7,p.y+p.vy+7) then
		p.vx=0
	end

	if solid(p.x  ,p.y+p.vy+8) or
	   solid(p.x+7,p.y+p.vy+8) then
		p.vy=0
	else
		p.vy=p.vy+0.2
	end

	if p.vy==0 and btnp(4) then
		p.vy=-2.5
	end

	if p.vy<0 and (solid(p.x+p.vx  ,p.y+p.vy) or
	   solid(p.x+p.vx+7,p.y+p.vy)) then
		p.vy=0
	end

	p.x=p.x+p.vx
	p.y=p.y+p.vy

	if edible(p.x+5,p.y) then
		mset(p.x//8,p.y//8,0) -- remove fruit
	end

	cls()
	map()
	spr(256+t%60//20,p.x,p.y,1,1,p.dir)

	if p.y>240 then
		p.vy = 0
		print("GAME OVER",90,90)
	end

	t = t + 1
end

init()

-- <TILES>
-- 001:7777777777000077007007000007700000077000007007007700007777777777
-- 002:a000000aa060060aaaaaaaaaaafaaa6aafffaaaaaafaa6aaaaaaaaaa33333333
-- 003:fffffffff1f11f1ff1f11f1ff1f11f1ff1f11f1ff1f11f1ff1f11f1fffffffff
-- </TILES>

-- <SPRITES>
-- 000:16eeee1166ee0ee1e66ee111e6e11111eee11111eeeee1111eeeeee111eeee11
-- 001:16eeee1166ee0ee1e66eeee1e6e11111eee11111eeeeeee11eeeeee111eeee11
-- 002:16eeee1166ee0ee1e66eeeeee6eeeeeeeeeeeeeeeeeeeeee1eeeeee111eeee11
-- </SPRITES>

-- <MAP>
-- 001:000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000000000000000000000000000000300000000000000000100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:101010100000000010000000101010101010000000100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:000000000000100000000000000000000000001000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000000000000000010000000000000000000000000001010100000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000000000000100020000000000000000000000000001000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000000000010101010100000000000000000000010101000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:000000000000000000101010100000000000101010100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:001010101010000000000000000010000000000000000000101010101000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:000000000000000000000000000010000000000020000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:c00070004000100010001000100010003000400050006000700080009000b000c000c000d000e000e000e000f000f000f000f000f000f000e000f000400000000000
-- </SFX>

-- <PATTERNS>
-- 000:400006400006600006600006800006800006600006600006400006400006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ec0000
-- </TRACKS>

-- <FLAGS>
-- 000:00102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:140c1c44243430346d4e4a4e854c30346524d04648757161597dced27d2c8595a16daa2cd2aa996dc2cadad45edeeed6
-- </PALETTE>

-- <COVER>
-- 000:1c2000007494648373160f0088003b000041c0c14442430343d6e4a4e458c4034356420d648457171695d7ec2dd7c258591ad6aac22daa99d62cacad4de5edee6dc2000000000f0088000040ff018c94badb83bedcbbff0682e84696e986aaeac6beeb07c2fc47d6fd87eafec7feff0c0a0784c2a1f88c4a279cc6a3f9058e26a4d964fa85955ba9dea735b5ae77c46058da5e4bad27e5cafdbe63c7e4693dfe95b3e7fcfebfff08182838485868788898a8b8c8d8e887f0192919f85972393969a9328929b9f9f1d9490a4aa12af05a9a717aaada31caeada0b1b31d66b7bb503a7528bdbebdb78fb2c26f2bb423c8c2c1c9cebab7682cc1d6bbc2d3d5cfc725dad4c58bd6cb2fd22edad4d3ecdd21e126e2d5ebeec160dbeccde6efe9b9d2f9c4bbfcfdfefff0030a0c1840b0a1c38803122947f781ee378d7026c298b7826b2b877036a2d83783292f8f6ff04e7219a684a62395605a2c59c2b5abc790336acc9943b6adcb9921b53ad61fe7941d9c8872e3f9f4456742734b95150ab848a9816f31e9327acb49d259ab319e35bae4c82c1aa7c8b631fa125b6552a835509d4bb0992bd83e6fd6a95b27980ddab24ee2e502a77faf8eb3600bf11ce5803f13c972ee645c4f0d0d24c85027646c68423d1bc15fed36acdd83f84fc513f95b2b5da1b867c07b475e3d0a32b9d14cab5f510b282636d4dce65bde3752f57deddcb7eafe040c387e45de739b2f5eccb9b3f7e0d3ab4f9eb9e43e0beb21bbd0de909b3d0fe701cb611dc25c7c03f401df5bc75e9cfd05f201e3a37f58b8bb9baa9bb8dfbfe16f766e2f58f7f186708d59c694018d1028c4066be107668d7ff91715828b1058a4038e285891868d6dd698517f02888f1085f988b99784dd21816a8161a8c26789fdb870a18232f0b26d8302d8836e073a07bfdf80460924e094461964e1984629a4e29c4639e4e390564925e494565965e5985669a5e69c5679e5279110000b3
-- </COVER>

