-- title:  lions
-- author: jaymzee
-- desc:   charlie's lion king game
-- script: lua
-- input:  gamepad

function solid(x,y)
	local s = mget(x//8,y//8) --get sprite at cell
	return x<0 or fget(s,0) --return solid flag
end

function edible(x,y)
	local s = mget(x//8,y//8)
	return fget(s,1) --return edible flag
end

function deadly(x,y)
	local s = mget(x//8,y//8)
	return fget(s,2) --return deadly flag
end

function TIC()
	--player left or right
	if p.alive then
		if btn(2) then
			p.vx=-1
			p.dir=1
		elseif btn(3) then
			p.vx=1
			p.dir=0
		else
			p.vx=0
		end
	end

 --check for solid tile on left or right
	if solid(p.x+p.vx  ,p.y+p.vy  ) or
	   solid(p.x+p.vx+7,p.y+p.vy  ) or
	   solid(p.x+p.vx  ,p.y+p.vy+7) or
	   solid(p.x+p.vx+7,p.y+p.vy+7) then
		p.vx=0
	end

 --check for solid tile below player
	if solid(p.x  ,p.y+p.vy+8) or
	   solid(p.x+7,p.y+p.vy+8) then
		p.vy=0
	else
		p.vy=p.vy+0.2 --gravity
	end

	if p.alive and p.vy==0 and btnp(4) then
		p.vy=-2.5 --jump
	end

	if p.vy<0 and
	  (solid(p.x+p.vx  ,p.y+p.vy) or
	   solid(p.x+p.vx+7,p.y+p.vy)) then
		p.vy=0
	end
	
 --update player position
	p.x=p.x+p.vx
	p.y=p.y+p.vy

	if edible(p.x+5,p.y) then
		mset(p.x//8,p.y//8,0) --eat fruit
	end
	
	if deadly(p.x+5,p.y) then
		p.vx=0
		p.vy=0
		p.alive=false		
	end
	
	if p.y>240 then
		p.vx=0
		p.vy=0
		p.alive=false
	end

 -- update display
	cls()
	map(p.x//240*30,0)
	
	if p.alive then
		spr(256+t%60//20,p.x%240,p.y,2,1,p.dir)
	else
		spr(259,p.x%240,p.y,2,1,p.dir)
		print("bye bye savanah",80,100)
	end
	
	if (t%120<30) then
		spr(272,220,20,2,1,0,0,2,2)
	end
	
	t = t + 1 --update time
end

function init()
	t=0
	p={
		x=120,
		y=68,
		vx=0, --velocity X
		vy=0, --velocity Y
		dir=0, --direction 0=left, 1=right
		alive=true
	}
end

init()

-- <TILES>
-- 000:3333733333733333333333733733333333333737337333337333733333333373
-- 001:3777733377707773777777077073777777777737773707773777737733737773
-- 002:33333333737333337373373304033333444373433344443334337343f333337f
-- 003:fffffffff1f11f1ff1f11f1ff1f11f1ff1f11f1ff1f11f1ff1f11f1fffffffff
-- 004:3333333333733333303030303070303030307070307030300000000000000000
-- </TILES>

-- <SPRITES>
-- 000:2e29992e2e9eee9e29ebebe929e5e5e929e000e929ee0ee92990e09922999992
-- 001:2e29992e2e9eee9e29eeeee92999e99929e000e929ee0ee929e0e09922999992
-- 002:2e29992e2e9eee9e29e5e5e929ebebe929e000e929ee0ee92990e09922999992
-- 003:22222222222222f222ffff222f0f0ff2f00ffff22f0f0ff222ffff22222222f2
-- 005:0e00000e0e0eee0e00eeeee00099e99000ee0ee000e0e0e0000eee0000000000
-- 006:0e00000e0e0eee0e00ebebe000ebebe000ee0ee000e0e0e0000eee0000000000
-- 016:222222222ee22eee2eeeeeee22eee00e222e0e0e222e0b0e222e0000222eee00
-- 017:22222222ee22ee22eeeeee2200eee2220e0ee2220b0e2222000e22220eee2222
-- 032:2222eee02222eee022222e0e222222ee222222ee222222222222222222222222
-- 033:eee22222eee222220e222222e2222222e2222222222222222222222222222222
-- </SPRITES>

-- <MAP>
-- 001:000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000000000000000000000000000000300000000000000000100000000000100010101000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:101010100000000010000000101010101010000000100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:000000000000000000000000000000000000000000000000000000000000100000000000101000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:000000000000100000000000000000000000001000000000000000000000100000000000000000000000000000000000000000101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000000000000000000000000000000000000000000000000000000000000100000000000000000000000001010100000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000000000000000010000000000000000000000000001010100000001010100000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000000000001010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000000000000100020000000000000000000000000001000000000000000100000000000000000001010101040404040401000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000000000010101010100000000000000000000010101000000000000000100000000000000000000000001010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:000000000000000000101010100000000000101010100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:001010101010000000000000000010000000000000000000101010101000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:000000000000000040000000000010000000000020000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:007000700070007000700070007000700070007000700070007000700070007000700070007000700070007000700070007000700070007000700070000000000000
-- </SFX>

-- <PATTERNS>
-- 000:40000640000660000660000680000680000660000660000640000640000610000000000000000000000000000040000a80000a90000ad0000af0000a80000a90000ad0000a40000a60000a80000a80000a60000ac0000a70000a70000aa0000a70000aa0000a60000a80000a90000ab0000a60000a80000a90000ab0000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ec0000
-- </TRACKS>

-- <FLAGS>
-- 000:00102010400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:140c1c44243430346d4e4a4e854c30346524d04648757161597dced27d2c8595a16daa2cd2aa996dc2cadad45edeeed6
-- </PALETTE>

-- <COVER>
-- 000:1c2000007494648373160f0088003b000041c0c14442430343d6e4a4e458c4034356420d648457171695d7ec2dd7c258591ad6aac22daa99d62cacad4de5edee6dc2000000000f0088000040ff018c94badb83bedcbbff0682e84696e986aaeac6beeb07c2fc47d6fd87eafec7feff0c0a0784c2a1f88c4a279cc6a3f9058e26a4d964fa85955ba9dea735b5ae77c46058da5e4bad27e5cafdbe63c7e4693dfe95b3e7fcfebfff08182838485868788898a8b8c8d8e887f0192919f85972393969a9328929b9f9f1d9490a4aa12af05a9a717aaada31caeada0b1b31d66b7bb503a7528bdbebdb78fb2c26f2bb423c8c2c1c9cebab7682cc1d6bbc2d3d5cfc725dad4c58bd6cb2fd22edad4d3ecdd21e126e2d5ebeec160dbeccde6efe9b9d2f9c4bbfcfdfefff0030a0c1840b0a1c38803122947f781ee378d7026c298b7826b2b877036a2d83783292f8f6ff04e7219a684a62395605a2c59c2b5abc790336acc9943b6adcb9921b53ad61fe7941d9c8872e3f9f4456742734b95150ab848a9816f31e9327acb49d259ab319e35bae4c82c1aa7c8b631fa125b6552a835509d4bb0992bd83e6fd6a95b27980ddab24ee2e502a77faf8eb3600bf11ce5803f13c972ee645c4f0d0d24c85027646c68423d1bc15fed36acdd83f84fc513f95b2b5da1b867c07b475e3d0a32b9d14cab5f510b282636d4dce65bde3752f57deddcb7eafe040c387e45de739b2f5eccb9b3f7e0d3ab4f9eb9e43e0beb21bbd0de909b3d0fe701cb611dc25c7c03f401df5bc75e9cfd05f201e3a37f58b8bb9baa9bb8dfbfe16f766e2f58f7f186708d59c694018d1028c4066be107668d7ff91715828b1058a4038e285891868d6dd698517f02888f1085f988b99784dd21816a8161a8c26789fdb870a18232f0b26d8302d8836e073a07bfdf80460924e094461964e1984629a4e29c4639e4e390564925e494565965e5985669a5e69c5679e5279110000b3
-- </COVER>

